<div class="spinner-container full-screen" *ngIf="loading" [@visibility]>
  <div class="spinner-new rotating"></div>
</div>

<ngb-alert type="danger" [dismissible]="false" *ngFor="let alert of alerts">{{alert}}</ngb-alert>

<div class="comment-periods">
  <div class="container" *ngIf="application">
    <div>
      <h1>Manage Comment Periods</h1>
    </div>

    <div class="row">
      <main class="col-md-8">
        <section class="p-0">
          <div class="review-comments__client-card card bg-light">
            <div class="card-header">
              <h2 class="mb-0">{{application.organization?.name || 'Unknown'}}</h2>
              <h3>{{application.purpose || '-'}} &nbsp; / &nbsp; {{application.subpurpose || '-'}}</h3>
              <h3>CL # &nbsp;{{application.cl_files ? application.cl_files.join(', ') : '-'}}</h3>
              <h3 *ngIf="application.features?.length > 0">Disp ID: &nbsp; {{application.features[0].properties.DISPOSITION_TRANSACTION_SID}}</h3>
            </div>
          </div>
        </section>
      </main>
      <nav class="col-md-4">
        <section class="d-flex flex-column">
          <a class="btn content-btn slide-l-btn btn-sm p-1 my-1" [routerLink]="['/a', application._id]">
            <i class="material-icons">info_outline</i>
            <span>Application Details</span>
          </a>
          <a class="btn content-btn slide-l-btn btn-sm p-1 my-1" [routerLink]="['/comments', application._id]">
            <i class="material-icons">message</i>
            <span>Review Comments</span>
          </a>
          <button class="btn btn-primary p-1 my-1" (click)="openCommentPeriod(null, application._id)" [disabled]="commentPeriods.length > 0">
            <i class="material-icons">add</i>
            <span>Add Comment Period</span>
          </button>
        </section>
      </nav>
    </div>
  </div>

  <div class="comment-periods-body container" id="anchor-point">
    <p *ngIf="commentPeriods.length === 0">
      <em>This application has no comment periods.</em>
    </p>

    <table class="table comment-periods-table">
      <tbody class="comment-periods-table__content">
        <tr *ngFor="let item of commentPeriods">
          <td class="comment-periods-table__item">
            <!-- <h4>Comment Period</h4> -->
            <h5>{{(item.startDate | date) || 'start'}} to {{(item.endDate | date) || 'end'}}</h5>
            <ul class="nv-list comment-periods-table__item--list">
              <li class="p-0">
                <span class="name">Status:</span>
                <span class="value">{{getStatus(item)}}</span>
              </li>
              <li class="p-0">
                <span class="name">Description:</span>
                <span class="value pre-wrap" [innerHTML]="item.description | newlines"></span>
              </li>
              <li class="p-0" *ngIf="item.internal">
                <span class="name">Internal Notes:</span>
                <span class="value pre-wrap" [innerHTML]="item.internal.notes | newlines"></span>
              </li>
              <!-- <li class="p-0">
              <span class="name"># Comments:</span>
              <span class="value">-</span>
            </li> -->
            </ul>
            <div class="comment-periods-table__item--buttons">
              <button class="btn btn-primary" (click)="openCommentPeriod(item, application._id)" title="Edit this comment period">
                <i class="material-icons">mode_edit</i>
                <span>Edit</span>
              </button>
              <button *ngIf="!item.isPublished" class="btn btn-danger" (click)="deleteCommentPeriod(item)" title="Delete this comment period">
                <i class="material-icons">delete</i>
                <span>Delete</span>
              </button>
              <button *ngIf="!item.isPublished" class="btn btn-success" (click)="publishCommentPeriod(item)" title="Publish this comment period">
                <i class="material-icons">play_arrow</i>
                <span>Publish</span>
              </button>
              <button *ngIf="item.isPublished" class="btn btn-dark" (click)="unPublishCommentPeriod(item)" title="Un-publish this comment period">
                <i class="material-icons">pause</i>
                <span>Un-Publish</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>