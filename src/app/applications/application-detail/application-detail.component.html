<div class="application-detail">
  <div class="container" *ngIf="application">
    <div>
      <h1>Application Details</h1>
      <a class="btn btn-primary btn-sm float-right" [routerLink]="['/a', application._id, 'edit']">
        <i class="material-icons">mode_edit</i>
        <span>Edit Application</span>
      </a>
    </div>

    <div class="row">
      <main class="col-lg-8">
        <!-- HEADER -->
        <section class="p-0">
          <div class="application-detail__client-card card bg-light">
            <div class="card-header">
              <h2 class="mb-0">{{application.organization?.name || 'Unknown'}}</h2>
              <h3>{{application.purpose || '-'}} &nbsp; / &nbsp; {{application.subpurpose || '-'}}</h3>
              <h3>{{applicationService.getStatus(application) || '-'}}</h3>
              <h3>CL File(s) &nbsp;{{application.cl_files ? application.cl_files.join(', ') : '-'}}</h3>
              <h3 *ngIf="application.features?.length > 0">Disp ID: &nbsp; {{application.features[0].properties.DISPOSITION_TRANSACTION_SID}}</h3>
            </div>

            <div class="card-body">
              <h2>BASIC INFORMATION</h2>

              <div *ngIf="!application.features || application.features.length === 0">
                <em>No features have been loaded.</em>
              </div>

              <ul class="application-detail__list" *ngIf="application.features?.length > 0">
                <li>
                  <span class="name">Type / Subtype</span>
                  <span class="value">{{application.features[0].properties.TENURE_TYPE || '-'}} / {{application.features[0].properties.TENURE_SUBTYPE
                    || '-'}}</span>
                </li>
                <li>
                  <span class="name">Status</span>
                  <span class="value">{{application.features[0].properties.TENURE_STATUS || '-'}}</span>
                </li>
                <li>
                  <span class="name">Stage</span>
                  <span class="value">{{application.features[0].properties.TENURE_STAGE || '-'}}</span>
                </li>
                <li>
                  <span class="name">Agency</span>
                  <span class="value">{{application.agency || '-'}}</span>
                </li>
                <!-- TODO: need border here -->
                <li>
                  <span class="name">Business Unit</span>
                  <span class="value">{{application.features[0].properties.RESPONSIBLE_BUSINESS_UNIT || '-'}}</span>
                </li>
                <li>
                  <span class="name">Region</span>
                  <span class="value">{{application.region || '-'}}</span>
                </li>
                <li>
                  <span class="name">Location</span>
                  <span class="value">{{application.features[0].properties.TENURE_LOCATION || '-'}}</span>
                </li>
                <li>
                  <span class="name">Total Area (hectares)</span>
                  <span class="value">{{application.areaHectares ? (application.areaHectares | number:'1.2-2') : '-'}}</span>
                </li>
              </ul>
            </div>
          </div>
        </section>

        <!-- APPLICATION -->
        <section>
          <h2>APPLICATION</h2>

          <h3>Description</h3>
          <p [innerHTML]="(application.description | newlines) || '-'"></p>

          <section class="application-detail__documents mt-2">
            <h3>Application Documents</h3>
            <div *ngIf="!application.documents || application.documents.length === 0">
              <em>This application has no documents.</em>
            </div>
            <div *ngFor="let document of application.documents" class="application-detail__document-list">
              <button class="btn btn-light btn-sm" (click)="api.downloadDocument(document)" title="Download this document">
                <i class="material-icons">file_download</i>
              </button>
              <button class="btn btn-light btn-sm" (click)="api.openDocument(document)" title="Open this document">
                <i class="material-icons">open_in_new</i>
              </button>
              <span [title]="document.displayName || ''">{{document.documentFileName}}</span>
            </div>
          </section>
        </section>

        <!-- DECISION -->
        <section>
          <h2>DECISION</h2>

          <div *ngIf="!application.decision">
            <em>No decisions have been made for this application at this time.</em>
          </div>

          <section *ngIf="application.decision" class="application-detail__documents mt-2">
            <h3>Description</h3>
            <p [innerHTML]="(application.decision.description | newlines) || '-'"></p>

            <h3>Decision Documents</h3>
            <div *ngIf="!application.decision.documents || application.decision.documents.length === 0">
              <em>This decision has no documents.</em>
            </div>
            <div *ngFor="let document of application.decision.documents" class="application-detail__document-list">
              <button class="btn btn-light btn-sm" (click)="api.downloadDocument(document)" title="Download this document">
                <i class="material-icons">file_download</i>
              </button>
              <button class="btn btn-light btn-sm" (click)="api.openDocument(document)" title="Open this document">
                <i class="material-icons">open_in_new</i>
              </button>
              <span [title]="document.displayName || ''">{{document.documentFileName}}</span>
            </div>
          </section>
        </section>

        <!-- GEOGRAPHIC SHAPE DATA -->
        <section class="application-detail__geo-shape-data">
          <h2>GEOGRAPHIC SHAPE DATA</h2>
          <label *ngIf="application.features">This application has
            <strong>{{application.features.length}}</strong> shape {{application.features.length === 1 ? 'file' : 'files'}}.
          </label>
          <span class="hover" (click)="launchMap()">
            <label class="float-right">See on map</label>
            <i class="material-icons float-right">place</i>
          </span>
          <ul class="application-detail__list" *ngFor="let shape of application.features">
            <hr>
            <li class="full-width">
              <span class="name main-label">Interest ID: {{shape.properties.INTRID_SID}}</span>
            </li>
            <li>
              <span class="name">Type/Subtype</span>
              <span class="value">{{shape.properties.TENURE_TYPE}}/{{shape.properties.TENURE_SUBTYPE}}</span>
            </li>
            <li>
              <span class="name">Area (ha)</span>
              <span class="value">
                {{shape.properties.TENURE_AREA_IN_HECTARES ? (shape.properties.TENURE_AREA_IN_HECTARES | number:'1.2-2') : '-'}}
              </span>
            </li>
            <li class="full-width">
              <span class="name">Legal Description</span>
              <span class="value">{{shape.properties.TENURE_LEGAL_DESCRIPTION}}</span>
            </li>
          </ul>
        </section>
      </main>

      <aside class="col-lg-4">
        <!-- MAP THUMBNAIL -->
        <section class="aside-map">
          <div class="map-container">
            <div class="map" style="height: 300px;" id="map"></div>
          </div>
        </section>

        <!-- COMMENTING INFO -->
        <section class="aside-commenting bg-light">
          <!-- <h2>Commenting Open</h2> -->
          <h2>{{commentPeriodService.getStatus(application.currentPeriod)}}</h2>
          <div *ngIf="commentPeriodService.getStatus(application.currentPeriod) === commentPeriodService.commentStatuses['OPEN']">
            <p>{{application.currentPeriod.startDate | date:'mediumDate'}} - {{application.currentPeriod.endDate | date:'mediumDate'}}</p>
            <div class="badge badge-secondary">{{daysRemaining}}</div>
          </div>
          <!-- <a class="btn btn-primary slide-r-btn" [routerLink]="['/periods', application._id]">
            <span>Click to Modify</span>
            <i class="material-icons">forward</i>
          </a> -->
          <a [routerLink]="['/periods', application._id]">Click to Modify &nbsp; &rsaquo;</a>
        </section>

        <!-- NEW COMMENTS INFO -->
        <section class="aside-comments bg-light">
          <h2>New Comments</h2>
          <!-- <p>Comments can be reviewed by following the link below.</p> -->
          <div>
            <div class="badge badge-secondary">{{numComments}}</div>
          </div>
          <!-- <a class="btn btn-primary slide-r-btn" [routerLink]="['/comments', application._id]">
            <span>Click to Review</span>
            <i class="material-icons">forward</i>
          </a> -->
          <a [routerLink]="['/comments', application._id]">Click to Review &nbsp; &rsaquo;</a>
        </section>
      </aside>
    </div>
  </div>
</div>