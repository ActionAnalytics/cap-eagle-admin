<div class="container" id="anchor-point">
    <div class="row">
    <main class="col-lg-12">
    <form (ngSubmit)="onSubmit()" #heroForm="ngForm">
      <section class="application-description card">
        <h4 class="card-header">Client</h4>
        <span class="">
          <label *ngIf="application.proponent">{{application.proponent.name}}</label>
          <button type="button" class="btn btn-success col-2 float-right" (click)="selectClient()">Select Client</button>
        </span>
    </section>
    <section class="application-description card">
        <h4 class="card-header">Description</h4>
        <textarea  type="text"
          class="form-control"
          id="description"
          name="description"
          [(ngModel)]="application.description"
          required></textarea>
    </section>

    <section class="application-description card">
      <span class="col-6">
        <input type="file"
              #fileInput
              placeholder="Upload file..."
              (change)="onChange($event, changedFiles)"
              multiple />
      </span>
      <button type="button" class="btn btn-success col-2" (click)="upload()">Upload</button>
    </section>

    <section class="application-description card">
      <ul class="nv-list application-details--list">
        <li>
          <div *ngFor="let file of applicationDocuments">
              <span class="name" (click)="downloadProtectedDocument(file)">{{file.displayName}}</span>
              <button *ngIf="!file.isPublished" type="button" class="btn btn-success"><span class="name" (click)="publishDocument(file)"><i class="material-icons">play_circle_outline</i></span></button>
              <button *ngIf="file.isPublished" type="button" class="btn btn-warning"><span class="name" (click)="unPublishDocument(file)"><i class="material-icons">pause_circle_outline</i></span></button>
              <button *ngIf="!file.isPublished" type="button" class="btn btn-danger"><span class="name" (click)="removeDocument(file)"><i class="material-icons">delete</i></span></button>
          </div>
        </li>
      </ul>
    </section>

      <section class="application-legal_description card">
        <h4 class="card-header">Legal Description</h4>
        <textarea  type="text"
        class="form-control"
        id="legalDescription"
        name="legalDescription"
        [(ngModel)]="application.legalDescription"
        required></textarea>
      </section>
      <section class="application-details card">
        <h4 class="card-header">Application Details</h4>
        <ul class="nv-list application-details--list">
          <li>
            <span class="name">Type</span>
            <select class="form-control"
                    id="type"
                    name="type"
                    required
                    (change)="typeChange(application.type)"
                    [(ngModel)]="application.type"
                    name="type">
              <option *ngFor="let type of types"
                      [value]="type">{{type}}</option>
            </select>
          </li>
          <li>
            <span class="name">Sub-Type</span>
            <select class="form-control"
                    id="subtype"
                    required
                    name="subtype"
                    [(ngModel)]="application.subtype"
                    name="subtype">
              <option *ngFor="let subtype of subtypes[application.type]"
                      [value]="subtype">{{subtype}}</option>
            </select>
          </li>
          <li>
            <span class="name">Project Date</span>
            <input type="date"
                    class="form-control"
                    id="projectDate"
                    name="projectData"
                    [ngModel]="application.projectDate | date:'yyyy-MM-dd'"
                    (ngModelChange)="application.projectDate = $event"
                    required useValueAsDate>
          </li>
          <li>
            <span class="name">Status</span>
            <select class="form-control"
                    id="status"
                    required
                    name="status"
                    [(ngModel)]="application.status"
                    name="status">
              <option *ngFor="let status of statuses"
                      [value]="status">{{status}}</option>
            </select>
          </li>
          <li>
            <span class="name">Region</span>
            <input type="text"
                    class="form-control"
                    id="region"
                    name="region"
                    [(ngModel)]="application.region"
                    required>
          </li>
          <li>
            <span class="name">Location</span>
            <input type="text"
                class="form-control"
                id="location"
                name="location"
                [(ngModel)]="application.location"
                required>
            <span class="name">Area (hectares)</span>
            <input type="number"
              class="form-control"
              id="areaHectares"
              name="areaHectares"
              step="0.01"
              [(ngModel)]="application.areaHectares"
              required>
            <span class="name">Latitude</span>
            <input type="number"
              class="form-control"
              id="latitude"
              name="latitude"
              step="0.01"
              [(ngModel)]="application.latitude"
              required>
            <span class="name">Longitude</span>
            <input type="number"
              class="form-control"
              id="longitude"
              name="longitude"
              step="0.01"
              [(ngModel)]="application.longitude"
              required>
          </li>
          <li>
            <label for="purpose">Purpose:</label>
            <select class="form-control"
                    id="purpose"
                    required
                    name="purpose"
                    [(ngModel)]="application.purpose"
                    (change)="purposeChange(application.purpose)"
                    name="purpose">
              <option *ngFor="let purpose of purposes"
                      [value]="purpose">{{purpose}}</option>
            </select>
          </li>
          <li>
            <label for="purpose">Sub-Purpose:</label>
            <select class="form-control"
                    id="subpurpose"
                    name="subpurpose"
                    required
                    [(ngModel)]="application.subpurpose"
                    name="subpurpose">
              <option *ngFor="let subpurpose of subpurposes[application.purpose]"
                      [value]="subpurpose">{{subpurpose}}</option>
            </select>
          </li>
          <!-- <li>
            <span class="value">{{application.latitude | coordinates:TransformationType.toDegree:Direction.Latitude}},
            <span class="name">Lat / Lon</span>
            <geo-coordinates [value]="10"></geo-coordinates>
              {{application.longitude | coordinates:TransformationType.toDegree:Direction.Longitude}}</span>
          </li> -->
          <li>
            <span class="name">Business Unit</span>
            <input type="text"
              class="form-control"
              id="businessUnit"
              name="businessUnit"
              [(ngModel)]="application.businessUnit"
              required>
          </li>
          <li>
            <div class="name">Crown Land File(s):</div>
              <div *ngFor="let clf of application.cl_files">
                  <span><div class="name col-4" (click)="removeCLFile(clf)">{{clf}}<i class="material-icons">delete_forever</i></div></span>
              </div>
              <div class="col-12">
                <input type="number"
                  class="name form-control col-4"
                  id="cl_files"
                  name="cl_files"
                  [(ngModel)]="clFile"
                  required>
                <button type="button pull-right" (click)="addCLFile()">Add CL File</button>
              </div>
          </li>
          <div *ngIf="application.internal" class="form-group">
            <section class="application-description card">
              <h4 class="card-header">Internal Notes</h4>
              <textarea  type="text"
                class="form-control"
                id="internal.notes"
                name="internal.notes"
                [(ngModel)]="application.internal.notes"
                required></textarea>
            </section>
          </div>
          <li>
              <button type="submit" class="btn btn-success">Submit</button>
              <button *ngIf="!application.isPublished" type="button" class="btn btn-success" (click)="publishApplication(application)">Publish</button>
              <button *ngIf="application.isPublished" type="button" class="btn btn-success" (click)="unPublishApplication(application)">Un-Publish</button>
              <button *ngIf="!application.isPublished" type="button" class="btn btn-danger" (click)="deleteApplication(application)">Delete</button>
          </li>
        </ul>

        <div *ngIf="showMsg">
          <div *ngIf="error" class="alert alert-danger">{{status}}</div>
          <div *ngIf="!error" class="alert alert-success">{{status}}</div>
        </div>
        <!-- <div class="map-section">
          <div class="map-section__thumbnail">
            <app-application-map [application]="application" [zoom]="4"></app-application-map>
          </div>
        </div> -->
      </section>
      </form>
    </main>
  </div>
</div>